(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n),document.addEventListener("click",r)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n),document.removeEventListener("click",r)}function n(e){var r=document.querySelector(".popup_is-opened");"Escape"===e.key&&t(r),e.target.removeEventListener("keydown",n)}function r(e){e.target.classList.contains("popup")&&t(e.target),e.target.removeEventListener("click",r)}var o=document.querySelector(".main"),a=o.querySelector(".handful-container-game"),c=o.querySelector(".game-history-container"),u=document.querySelector(".control__panel"),l=o.querySelector(".button__restart"),i=document.querySelector(".game__title"),s=o.querySelector(".page__title"),d=document.querySelector(".button_type-start");function m(e,t){t>12&&(t=12);for(var n=document.querySelector(".handful-list__image-item-template").content,r=1;r<=t;r++){var o=n.querySelector(".handful-list__image-item").cloneNode(!0);e.append(o)}}function f(e){Array.from(e.querySelectorAll("li")).forEach((function(e){e.remove()}))}function h(e){e.forEach((function(e){e.classList.contains("handful-checked")&&e.classList.remove("handful-checked")}))}function _(e){e.classList.add("handful-checked")}function v(e,t){e.target.classList.contains("handful")&&(h(t),_(e.target)),e.target.parentNode.classList.contains("handful")&&(h(t),_(e.target.parentNode)),e.target.parentNode.parentNode.classList.contains("handful")&&(h(t),_(e.target.parentNode.parentNode))}function y(e){Array.from(e.querySelectorAll(".handful")).forEach((function(e){"0 шт."===e.querySelector(".handful__count").textContent&&e.remove()}))}function p(e,t){var n=e.querySelector(".handful__count"),r=n.textContent.substring(0,2),o=e.querySelector(".handful-list__image");f(o),n.textContent="".concat(String(Number(r)-Number(t))," шт."),m(o,Number(r)-Number(t))}function S(e){return 0===Array.from(e.querySelectorAll("li")).length}function q(e,t,n,r,o){var a=document.querySelector(".history-item-template").content.querySelector(".history-item").cloneNode(!0),c=n.querySelector(".handful__number").textContent;a.textContent="".concat(t,". ").concat(o," взял ").concat(r," шт. из кучки №").concat(c),e.prepend(a)}function g(e,t,n){var r=document.querySelector(".history-item-template").content.querySelector(".history-item").cloneNode(!0);if(2===n)return r.classList.add("message-error"),r.textContent="Похоже, что кучек нет",void e.prepend(r);if(1===n&&t){var o=t.querySelector(".handful__number").textContent;return r.classList.add("message-good"),r.textContent="Из кучки №".concat(o," забрали всё"),void e.prepend(r)}return 3===n?(r.classList.add("message-error"),r.textContent="В кучке меньше предметов",void e.prepend(r)):4===n?(r.classList.add("message-info"),r.textContent="Выберете кучку",void e.prepend(r)):void 0}var L=document.querySelector(".main"),b=document.querySelector(".popup_type-start"),x=document.querySelector(".button_type-start"),C=document.querySelector(".popup_type-how-many"),k=b.querySelector(".popup__button-close"),N=C.querySelector(".popup__button-close"),E=C.querySelector(".popup__button-start"),A=document.forms.assignItem,w=A.assignCount,M=C.querySelector(".handful-container"),Z=L.querySelector(".handful-container-game"),R=L.querySelector(".game-history-container"),T=L.querySelector(".button__restart"),D=(document.querySelector(".game__title"),L.querySelector(".page__title"),document.forms["start-game"]),F=document.querySelector(".control__panel"),W=F.querySelector(".panel-text"),Y=F.panelInput,I=document.querySelector(".popup_type-final"),G=I.querySelector(".popup__button-close"),Q=I.querySelector(".end-message"),V=I.querySelector(".final-gif"),j=1,B="Игрок";function O(t){B="Компьютер";var n=function(e){var t=Array.from(e.querySelectorAll(".handful"));if(t){var n=0;if(t.forEach((function(e){var t=e.querySelector(".handful__count"),r=Number(t.textContent.substring(0,2));n^=r})),0===n){var r=t[Math.floor(Math.random()*t.length)],o=Number(r.querySelector(".handful__count").textContent.substring(0,2));return{handful:r,countRemove:Math.floor(Math.random()*o)+1,random:!0}}for(var a=n.toString(2),c=0,u=0;u<a.length;u++)if("1"===a[u]){c=a.length-u;break}for(var l=0;l<t.length;l++){var i=Number(t[l].querySelector(".handful__count").textContent.substring(0,2)),s=i.toString(2);if(c<=s.length)for(var d=0;d<s;d++)if("1"===s[s.length-Number(c)]){var m=i-(i^n);return{handful:t[l],countRemove:m,random:!1}}}}}(t),r=n.handful.querySelector(".handful__count").textContent.substring(0,2);if(p(n.handful,n.countRemove),q(R,j,n.handful,n.countRemove,B),j++,Number(r)===Number(n.countRemove)&&(g(R,n.handful,1),y(t)),y(t),S(t))return g(R,n.handful,2),W.textContent="Взять из кучки №",Q.textContent="".concat(B," выиграл!"),void e(I);B="Игрок"}G.addEventListener("click",(function(){t(I)})),x.addEventListener("click",(function(){e(b)})),D.addEventListener("submit",(function(n){n.preventDefault(),t(b);var r=D["number-of-handful"].value;!function(e,t){for(var n=1;n<=t;n++){var r=(o=n,a=void 0,c=void 0,u=void 0,c=(a=document.querySelector(".handful-template").content.querySelector(".handful").cloneNode(!0)).querySelector(".handful__number"),u=a.querySelector(".handful__count"),m(a.querySelector(".handful-list__image"),0),c.textContent="".concat(o,"."),u.textContent="".concat(0," шт."),a);e.append(r)}var o,a,c,u}(M,r),e(C)})),k.addEventListener("click",(function(){t(b)})),N.addEventListener("click",(function(){t(C),D.reset(),f(M)})),E.addEventListener("click",(function(){if(r=M,m=Array.from(r.querySelectorAll(".handful")),f=0,m.forEach((function(e){var t=Number(e.querySelector(".handful__count").textContent.substring(0,2));f+=t})),0===f)alert("Заполните хотя бы одну кучку");else{t(C),Array.from(M.querySelectorAll(".handful")).forEach((function(e){Z.append(e)})),y(Z);var e=Z.querySelector(".handful-checked");if(e){var n=e.querySelector(".handful__number").textContent;W.textContent="Взять из кучки №".concat(n)}s.classList.add("element_hide"),d.classList.add("element_hide"),o.classList.add("main__game"),o.classList.remove("main__start"),a.classList.remove("element_hide"),c.classList.remove("element_hide"),u.classList.remove("element_hide"),l.classList.remove("element_hide"),i.classList.remove("element_hide"),D.whoFirst.checked&&"computer"===D["against-whom"].value&&setTimeout((function(){O(Z)}),500),D.whoFirst.checked&&"man"===D["against-whom"].value&&(B="Соперник")}var r,m,f})),T.addEventListener("click",(function(){D.reset(),f(Z),f(R),F.reset(),a.classList.add("element_hide"),c.classList.add("element_hide"),u.classList.add("element_hide"),l.classList.add("element_hide"),i.classList.add("element_hide"),o.classList.remove("main__game"),o.classList.add("main__start"),s.classList.remove("element_hide"),d.classList.remove("element_hide")})),A.addEventListener("submit",(function(e){e.preventDefault();var t,n,r,o,a=M.querySelector(".handful-checked");a&&(t=a,n=w.value,r=t.querySelector(".handful__count"),o=t.querySelector(".handful-list__image"),r.textContent="".concat(n," шт."),m(o,n)),A.reset()})),M.addEventListener("click",(function(e){v(e,Array.from(M.querySelectorAll("li")))})),Z.addEventListener("click",(function(e){v(e,Array.from(Z.querySelectorAll("li")));var t=Z.querySelector(".handful-checked");if(t){var n=t.querySelector(".handful__number").textContent;W.textContent="Взять из кучки №".concat(n)}})),F.addEventListener("submit",(function(t){t.preventDefault();var n=Z.querySelector(".handful-checked");if(n){var r=n.querySelector(".handful__count").textContent.substring(0,2);!function(e,t){if(e){var n=e.querySelector(".handful__count").textContent.substring(0,2);return!(Number(n)<Number(t))}}(n,Y.value)?g(R,n,3):(p(n,Y.value),q(R,j,n,Y.value,B),j++,Number(r)===Number(Y.value)&&(g(R,n,1),y(Z),W.textContent="Взять из кучки №"),y(Z),S(Z)&&(g(R,n,2),W.textContent="Взять из кучки №",Q.textContent="".concat(B," выиграл!"),"Компьютер"!=B&&(V.src="https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExMDZnMWF4YTZ2Mnp5eWlkZXRkdTViZTB2Zm82Ynl4N2tham5tOG52byZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/10FwycrnAkpshW/giphy.gif"),e(I)),F.reset(),"computer"!==D["against-whom"].value||S(Z)||setTimeout((function(){O(Z)}),500),"man"!==D["against-whom"].value||S(Z)||(B=function(e){return"Игрок"===e?"Соперник":"Игрок"}(B)))}else S(Z)?(g(R,n,2),W.textContent="Взять из кучки №",Q.textContent="".concat(B," выиграл!"),e(I)):g(R,n,4)}))})();